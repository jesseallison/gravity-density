<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Gravity|Density</title>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/anim.css">

  <link href="http://fonts.googleapis.com/css?family=Vollkorn" rel="stylesheet" type="text/css">

  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript" src="js/Tone.min.js"></script>
  <script type="text/javascript" src="js/nexusUI.js"></script>
  <script type="text/javascript" src="js/browserHub.js"></script>
  <script type="text/javascript" src="js/StartAudioContext.js"></script>
  <script src="js/wavesurfer.min.js"></script>
  <script src="js/wavesurfer.regions.min.js"></script>

</head>

<body>
  <div class="display">

    <h1 onclick="demoSound.triggerFirstSound();"><span class="mainTitle">Gravity|Density</span></h1>

    <div class="nexusOverlay">
      <p>Artists | <strong>Jesse Allison & Anthony Marasco</strong></p>
      <p>Start by tapping your approximate location in the space.</p>
      <svg version="1.1" id="seatMap" x="0px" y="0px" viewbox="0 0 640 445"
        style="max-width: 70vh; enable-background:new 0 0 640 445;">
        <rect x="4" y="4" style="fill:none;stroke:#B3B3B3;stroke-width:8;stroke-miterlimit:10;" width="632"
          height="437" />
        <rect x="77.5" y="70" style="fill:none;stroke:#4D4D4D;stroke-width:8;stroke-miterlimit:10;" width="485.1"
          height="350" />
        <line style="fill:none;stroke:#4D4D4D;stroke-width:18;stroke-miterlimit:10;" x1="30" y1="40" x2="610" y2="40" />
      </svg>
    </div>

    <div class="mainDisplay">
      <p>
        <br>
        <br><em>Gravity|Density<br>
          Sample what you like.<br>
          Select a region and set it.</em>
<br>
          <!-- <object type="image/svg+xml" data="data/dots.svg" width="300px" height"300px">
            Dots 
          </object> -->

          <svg xmlns="http://www.w3.org/2000/svg" width="300" height="200" style="isolation:isolate" viewBox="0 0 360 640"><defs><clipPath id="a"><path class="svg-elem-1" d="M0 0h360v640H0z"/></clipPath></defs><g clip-path="url(#a)"><path d="M179.765 202.412c14.785 0 26.822-12.037 26.822-26.822 0-14.785-12.037-26.822-26.822-26.822-14.785 0-26.822 12.037-26.822 26.822.055 14.84 12.037 26.822 26.822 26.822z" fill="#00AAD1" class="svg-elem-2"/><path d="M232.475 138.709a5.911 5.911 0 005.936-5.936 5.912 5.912 0 00-5.936-5.936 5.912 5.912 0 00-5.936 5.936 5.911 5.911 0 005.936 5.936zM99.354 230.663c0-4.782-3.902-8.684-8.684-8.684-4.782 0-8.684 3.902-8.684 8.684 0 4.782 3.902 8.684 8.684 8.684 4.782 0 8.684-3.902 8.684-8.684z" fill="#FED710" class="svg-elem-3"/><path d="M285.02 169.874c-3.023 0-5.497 2.473-5.497 5.496v.275c0 3.023 2.474 5.496 5.497 5.496 3.023 0 5.496-2.473 5.496-5.496v-.22c0-3.078-2.473-5.551-5.496-5.551zm-.88-9.014a5.492 5.492 0 10-1.672-10.855 5.492 5.492 0 001.672 10.855zm4.397 35.726c.55-2.968-1.374-5.881-4.342-6.431-2.968-.55-5.881 1.374-6.43 4.342a5.5 5.5 0 005.386 6.541c2.583 0 4.892-1.814 5.386-4.452zm-85.193 75.959a5.501 5.501 0 00-4.067 6.65 5.451 5.451 0 006.651 4.013 5.503 5.503 0 004.067-6.651c-.715-2.968-3.683-4.727-6.651-4.012zM163.881 65.993a5.497 5.497 0 00.769 10.938c.275 0 .55 0 .77-.055 3.023-.44 5.111-3.243 4.672-6.211-.44-2.968-3.243-5.057-6.211-4.672zm-90.415 78.543a5.528 5.528 0 005.277 7.035 5.506 5.506 0 005.276-3.958 5.53 5.53 0 00-3.737-6.815c-2.913-.879-5.991.824-6.816 3.738zm132.242-76.619c-2.968-.715-5.936 1.099-6.596 4.067-.714 2.968 1.099 5.936 4.067 6.596.44.11.88.165 1.265.165a5.504 5.504 0 005.331-4.233c.715-2.913-1.099-5.881-4.067-6.595zM69.509 165.202a5.496 5.496 0 004.947 5.991h.494a5.541 5.541 0 005.497-5.002A5.496 5.496 0 0075.5 160.2a5.606 5.606 0 00-5.991 5.002zm208.036 55.018c2.198 0 4.232-1.319 5.111-3.463a5.445 5.445 0 00-3.078-7.145c-2.803-1.154-5.991.22-7.145 3.078a5.465 5.465 0 005.112 7.53zm-12.312-106.299c-2.528 1.649-3.298 5.057-1.649 7.585 1.044 1.594 2.803 2.528 4.617 2.528a5.507 5.507 0 004.617-8.464 5.457 5.457 0 00-7.585-1.649zm-24.349 152.908c1.1 0 2.199-.33 3.188-1.045a5.475 5.475 0 10-6.376-8.904c-2.473 1.759-3.023 5.222-1.264 7.695 1.045 1.484 2.748 2.254 4.452 2.254zm-.22-171.541c1.704 0 3.408-.824 4.507-2.308 1.759-2.473 1.155-5.936-1.319-7.695-2.473-1.759-5.936-1.154-7.64 1.319a5.492 5.492 0 004.452 8.684zm-17.313-10.003c2.089 0 4.067-1.209 5.002-3.243 1.264-2.748.055-6.046-2.749-7.255-2.803-1.209-6.045-.055-7.255 2.748-1.264 2.749-.055 6.046 2.749 7.256a5.385 5.385 0 002.253.494zm28.691 13.576c-2.199 2.089-2.254 5.551-.165 7.75 1.099 1.099 2.528 1.704 3.957 1.704 1.374 0 2.748-.495 3.793-1.539a5.482 5.482 0 00-7.585-7.915zm-127.57 172.694c.88.495 1.814.715 2.748.715a5.508 5.508 0 002.749-10.278c-2.639-1.539-5.991-.605-7.53 2.034-1.484 2.693-.605 6.045 2.033 7.529zm41.168 2.804c-3.023-.44-5.772 1.649-6.211 4.671-.44 3.023 1.649 5.772 4.672 6.211.274.055.549.055.769.055a5.496 5.496 0 00.77-10.937zm90.359-20.612c1.429 0 2.913-.549 3.957-1.703a5.482 5.482 0 00-2.651-9.116 5.48 5.48 0 00-5.263 1.531c-2.089 2.198-2.034 5.661.165 7.749 1.044.99 2.418 1.539 3.792 1.539zm-149.225-2.143a5.485 5.485 0 00.55 7.75 5.532 5.532 0 003.572 1.319 5.54 5.54 0 004.177-1.924 5.486 5.486 0 00-.549-7.75c-2.309-1.923-5.771-1.649-7.75.605zM143.38 70.995a5.479 5.479 0 00-4.057 9.186 5.48 5.48 0 005.815 1.477c.605 0 1.21-.11 1.814-.33 2.858-.989 4.397-4.122 3.408-6.98-.935-2.859-4.122-4.343-6.98-3.353zm41.497-5.991c-3.023-.11-5.606 2.198-5.716 5.221a5.44 5.44 0 005.221 5.716h.275c2.913 0 5.331-2.308 5.496-5.221.11-3.023-2.253-5.606-5.276-5.716zm36.385 201.385c-2.748 1.264-3.957 4.507-2.693 7.31.935 2.034 2.913 3.188 5.002 3.188.769 0 1.539-.165 2.308-.495 2.748-1.264 3.958-4.507 2.693-7.31-1.264-2.748-4.561-3.957-7.31-2.693zm54.139-135.21a5.489 5.489 0 00-3.023 7.146 5.525 5.525 0 007.145 3.078c2.804-1.155 4.178-4.342 3.023-7.146a5.51 5.51 0 00-7.145-3.078zM143.654 280.35c.605.219 1.21.274 1.814.274 2.254 0 4.397-1.429 5.222-3.682.989-2.858-.55-5.991-3.408-6.98-2.858-.99-5.991.549-6.98 3.407a5.384 5.384 0 003.352 6.981zm127.68-52.49a5.456 5.456 0 00-7.585 1.649 5.457 5.457 0 001.649 7.585 5.346 5.346 0 002.968.879c1.814 0 3.572-.879 4.617-2.528 1.649-2.529.879-5.936-1.649-7.585zM124.252 79.789a5.485 5.485 0 00-1.978 7.53c1.044 1.759 2.858 2.748 4.781 2.748.935 0 1.869-.22 2.749-.715a5.487 5.487 0 001.978-7.529 5.456 5.456 0 00-7.53-2.034zm-17.093 12.257a5.485 5.485 0 00-.55 7.749 5.45 5.45 0 004.122 1.869 5.442 5.442 0 003.628-1.374c2.308-1.979 2.528-5.496.55-7.75-1.979-2.253-5.497-2.528-7.75-.494zm-18.468 30.559c-2.693-1.374-5.991-.33-7.42 2.364a5.495 5.495 0 004.892 8.024 5.565 5.565 0 004.892-2.968c1.374-2.693.329-5.991-2.364-7.42zm11.652-16.269a5.455 5.455 0 00-7.695.934 5.454 5.454 0 00.935 7.695 5.544 5.544 0 003.408 1.155 5.52 5.52 0 004.342-2.089c1.813-2.363 1.429-5.826-.99-7.695zm84.259 168.902a5.497 5.497 0 00-4.554 8.363 5.497 5.497 0 004.829 2.63h.275c3.023-.165 5.386-2.694 5.221-5.771-.165-3.023-2.748-5.332-5.771-5.222zM78.798 210.876a5.528 5.528 0 005.276-7.035 5.531 5.531 0 00-6.815-3.738 5.533 5.533 0 00-3.738 6.816 5.507 5.507 0 005.277 3.957zm-4.287-30.614a5.496 5.496 0 00-4.947 5.991c.275 2.858 2.638 5.001 5.441 5.001h.55a5.496 5.496 0 004.947-5.991 5.497 5.497 0 00-5.991-5.001zm174.508.879c3.023 0 5.496-2.473 5.496-5.496v-.11c0-3.023-2.473-5.497-5.496-5.497-3.023 0-5.497 2.474-5.497 5.497v.11c0 3.023 2.474 5.496 5.497 5.496zm-138.453.055c3.023 0 5.497-2.473 5.497-5.496 0-3.023-2.474-5.497-5.497-5.497-3.022 0-5.496 2.474-5.496 5.497 0 3.023 2.474 5.496 5.496 5.496zm132.132 34.847c1.649-2.529.879-5.936-1.649-7.585a5.441 5.441 0 00-7.585 1.649 5.508 5.508 0 004.617 8.464 5.85 5.85 0 004.617-2.528zm-94.042-108.388c-2.748 1.264-3.957 4.507-2.693 7.31.934 2.034 2.913 3.188 5.001 3.188.77 0 1.539-.165 2.309-.494 2.748-1.265 3.957-4.507 2.693-7.311-1.319-2.748-4.562-3.957-7.31-2.693zm-17.863 11.542a5.484 5.484 0 00-.55 7.75 5.457 5.457 0 004.123 1.869c1.264 0 2.583-.44 3.627-1.319a5.496 5.496 0 10-7.2-8.3zm120.699 77.499a5.463 5.463 0 00-3.737-6.816 5.468 5.468 0 00-4.189.445 5.47 5.47 0 00-2.627 3.293 5.508 5.508 0 005.277 7.035c2.418-.055 4.617-1.594 5.276-3.957zm-136.638-45.785a5.533 5.533 0 00-6.816 3.738 5.508 5.508 0 005.277 7.035 5.506 5.506 0 005.276-3.957c.825-2.913-.824-5.991-3.737-6.816zm114.433 73.431c-1.979-2.308-5.441-2.528-7.75-.55-2.308 1.979-2.528 5.442-.549 7.75 1.099 1.264 2.638 1.869 4.177 1.869 1.264 0 2.583-.44 3.627-1.374 2.254-1.924 2.474-5.386.495-7.695zM195.1 243.359c-.44-3.023-3.188-5.111-6.211-4.672-3.023.44-5.112 3.188-4.672 6.211.385 2.748 2.748 4.727 5.442 4.727.274 0 .549 0 .769-.055a5.442 5.442 0 004.672-6.211zm-56.447-11.762c1.978-2.308 1.759-5.771-.55-7.75-2.308-1.978-5.771-1.758-7.75.55-1.978 2.309-1.759 5.771.55 7.75a5.532 5.532 0 003.572 1.319c1.539 0 3.078-.605 4.178-1.869zm74.915 4.727c-1.265-2.748-4.507-3.957-7.311-2.693-2.803 1.264-3.957 4.507-2.693 7.31.935 2.034 2.913 3.188 5.002 3.188.769 0 1.539-.165 2.308-.495 2.749-1.319 3.958-4.562 2.694-7.31zm-101.737-46.389a5.533 5.533 0 00-3.738 6.816 5.507 5.507 0 006.816 3.737 5.53 5.53 0 003.737-6.815 5.44 5.44 0 00-6.815-3.738zm5.056-54.633a5.506 5.506 0 004.617 8.464 5.497 5.497 0 002.968-10.113c-2.583-1.649-5.991-.935-7.585 1.649zm127.735 15.389a5.533 5.533 0 00-3.738 6.816c.715 2.363 2.913 3.957 5.277 3.957a5.53 5.53 0 005.276-7.035c-.824-2.913-3.902-4.562-6.815-3.738zm-80.247-42.816c.385 2.748 2.749 4.727 5.442 4.727.275 0 .549 0 .769-.055a5.497 5.497 0 10-6.211-4.672zm11.048 137.078c.44-3.023-1.649-5.771-4.672-6.211-3.023-.439-5.771 1.649-6.211 4.672-.439 3.023 1.649 5.771 4.672 6.211.275.055.55.055.77.055a5.495 5.495 0 005.441-4.727zm8.684-138.672c-.439 3.023 1.649 5.771 4.672 6.211.275.055.495.055.77.055a5.497 5.497 0 10-5.442-6.266zm19.347 4.012a5.508 5.508 0 005.002 7.805c2.089 0 4.067-1.209 5.002-3.243 1.264-2.748.055-6.046-2.749-7.255a5.469 5.469 0 00-7.255 2.693zm-81.895 108.333a5.509 5.509 0 004.617-8.464c-1.649-2.529-5.057-3.298-7.585-1.649-2.528 1.649-3.298 5.056-1.649 7.585 1.045 1.594 2.803 2.528 4.617 2.528zm34.517 22.315c1.264-2.748.055-6.046-2.693-7.31-2.748-1.264-6.046-.055-7.31 2.693-1.264 2.748-.055 6.046 2.693 7.31a5.573 5.573 0 007.31-2.693zm-14.071-65.296c0 20.831 16.984 37.814 37.815 37.814 20.831 0 37.815-16.983 37.815-37.814s-16.984-37.815-37.815-37.815c-20.831 0-37.815 16.929-37.815 37.815zm37.76-26.822c14.785 0 26.822 12.037 26.822 26.822 0 14.785-12.037 26.822-26.822 26.822-14.785 0-26.822-12.037-26.822-26.822.055-14.785 12.037-26.822 26.822-26.822zm52.71.879c9.344 0 16.929-7.585 16.929-16.929 0-9.343-7.585-16.928-16.929-16.928-9.344 0-16.929 7.585-16.929 16.928 0 9.344 7.585 16.929 16.929 16.929zm0-22.865a5.912 5.912 0 015.936 5.936 5.911 5.911 0 01-5.936 5.936 5.911 5.911 0 01-5.936-5.936 5.912 5.912 0 015.936-5.936zm-141.75 84.149c-10.855.03-19.647 8.822-19.677 19.677 0 10.828 8.849 19.677 19.677 19.677s19.677-8.849 19.677-19.677c-.055-10.828-8.849-19.677-19.677-19.677zm-8.684 19.677c0-4.782 3.902-8.684 8.684-8.684 4.782 0 8.684 3.902 8.684 8.684 0 4.782-3.902 8.684-8.684 8.684-4.782 0-8.684-3.902-8.684-8.684z" fill="#2D3033" class="svg-elem-4"/></g></svg>

          <div class="controls">
              <button class="btn-draw" onclick="draw();">Draw</button>
              <button class="btn-erase" onclick="erase();">Erase</button>
            </div>
        <br>
        <button onClick="sample()">Test Sample Some Audio</button>
        <br>
        <button onClick="setLoop()">Test Set Loop Points</button>
        <br>
        <button onClick="wavesurfer.play()">Play</button><button onClick="wavesurfer.pause()">Pause</button>
        <br>
        <button onClick="setRegion()">Set Sound</button>
        <br>
        <button onClick="serverPlay()">Play</button> -- <button onClick="serverPause()">Pause</button> -- <button onClick="serverLoop()">Loop</button>
        <br>
        <div id="slider1"></div>
        <br>
        <div id="waveform"></div>
        <p style="display:none;">
          <button onClick="test1()">Test 1</button>
          <button onClick="test2()">Test 2</button>
          <button onClick="test3()">Test 3</button>
          <button onClick="test4()">Test 4</button>
          <button onClick="test5()">Test 5</button>
          <button onClick="test6()">Test 6</button>
        </p>
        <br><br>
        <button onClick="tapEnd()">Tap To End Session</button>
      </p>

    </div>

  </div>

  <div id="typed-text">...</div>

  <div class="endDisplay" style="display: none;">
    <p>
      <br>
      <br><em>Thanks for tapping!<br>
        Please visit <a href="http://gravity.emdm.io">gravity.emdm.io</a> for documentation.</em>
    </p>
  </div>

  <script>
    var wrapper = document.querySelector('.mainDisplay svg')

    function draw() {
      wrapper.classList.add('active')
    }

    function erase() {
      wrapper.classList.remove('active')
    }

    var Hub = require('hub');
    var hub = new Hub();
    hub.init();

    hub.user.name = "a_user_" + Math.floor(Math.random()*99999);
    hub.user.color = getRandomColor();
    console.log(hub.user.color);
    hub.user.location = {
      x: 0.5,
      y: 0.5
    }

    let slider = new Nexus.Slider('#slider1', {
      'mode': 'absolute'
    });
    hub.channel('sharedSlider', null, null, function (data) {
      slider.value = data.value;
    });
    slider.on('change', function (v) {
      // do not send along if not changed from a user interaction.
      if (slider.clicked) {
        hub.send('sharedSlider', {
          value: v
        });
      };
    });


    hub.channel('sample', null, null, (data) => {
      // data.user = "name", .sample = "bang", .duration = "5"
      console.log(`${data.user} recording sample`);
      if(data.user === hub.user.name || data.user == 'all') {
        if(data.user == 'all') {
          if (data.val == "load") {
            setTimeout((url) => {wavesurfer.load(url)},500,data.url);
          }
        } else {
          if (data.val == "load") {
            setTimeout((url) => {wavesurfer.load('/uploads/'+url)},2000,data.url);
          }
        }
        if (data.val == "play") {
            wavesurfer.play();
          }
          if (data.val == "loop") {
            //wavesurfer.play();
            wavesurfer.regions.list[1].play();
          }
      }
    });

    function sample() {
      hub.transmit('sample', null, {
        'user': hub.user.name,
        'val': 'capture',
        'duration': '5'
      });
    };

    function setRegion() {
      hub.transmit('sample', null, {
        'user': hub.user.name,
        'val': 'play'
      });
    }

    function serverPlay() {
      hub.transmit('sample', null, {
        'user': hub.user.name,
        'val': 'play'
      })
    }

    function serverPause() {
      hub.transmit('sample', null, {
        'user': hub.user.name,
        'val': 'pause'
      })
    }

    function serverLoop() {
      hub.transmit('sample', null, {
        'user': hub.user.name,
        'val': 'loop'
      })
    }

    // hub.channel('loop', null, null, (data) => {
    //   // data.user = "name", .loopBegin = 0., .loopEnd = 1.0
    // });

    function setLoop(user, begin, end) {
      // hub.transmit('loop', null, {
      //   'user': hub.user.name,
      //   'loopBegin': 0.5,
      //   'loopEnd': 0.75
      // });
      hub.transmit('sample', null, {
        'user': hub.user.name,
        'val': 'loop',
        'loopBegin': wavesurfer.regions.list[1].start/wavesurfer.getDuration(),
        'loopEnd': wavesurfer.regions.list[1].end/wavesurfer.getDuration()
      });
    }

    var secNum = 0;

    document.getElementsByTagName("body")[0].style.borderLeft = "15px solid " + hub.user.color;

    seatMap.addEventListener("click", getClickPosition, false);
    StartAudioContext(Tone.context, '#seatMap').then(function () {
      console.log("AudioStarted");
      //reverb.generate();
    })

    function getClickPosition(e) {
      var m = seatMap.getScreenCTM();
      var p = document.getElementById('seatMap').createSVGPoint();
      p.x = e.clientX;
      p.y = e.clientY;
      p = p.matrixTransform(m.inverse());
      var tx = document.getElementById('seatMap').getAttribute("viewBox").split(" ")[2];
      var ty = document.getElementById('seatMap').getAttribute("viewBox").split(" ")[3];
      var mx = p.x / tx;
      var my = p.y / ty;

      hub.user.location.x = mx;
      hub.user.location.y = my;
      console.log(hub.user.location);

      demoSound.triggerPitch();
      hub.register();
      // FIXME: move default overlay into Hub
      document.getElementsByClassName("nexusOverlay")[0].style.display = 'none';
      document.getElementsByClassName("mainDisplay")[0].style.display = 'block';
      // wavesurfer.load('data/mbira_em.mp3');
    }

    hub.channel('chat', null, null, function (data) {
      console.log("chat: " + data);
    });

    hub.channel('setSection', null, null, function (data) {
      console.log(data);
      console.log("the section is now: " + data.title);

      secNum = data.sect;

    });

    hub.channel('tap', null, null, function (data) {
      hub.log(`
        tap received: $ {
            data
        }
        `);
    })

    function tapButton() {
      hub.send('tap', {
        'tap': 1
      });
    }

    hub.channel('itemback', null, 'about', function (data) {
      console.log("itemback: ", data);
    });

    var numClicked = 0;

    hub.channel('item', 'item', ['audio', 'display'])

    function itemButton() {
      console.log("numClicked = " + numClicked);
      hub.send('item', {
        "item": numClicked
      });

      demoSound.playSecondSound();
      numClicked++
    }

    hub.channel('tapOthers', null, null, function (data) {
      console.log('Other Person: ', data);
      demoSound.playPitch(data.pitch);
    });

    function triggerOthersButton() {
      hub.send('tapOthers', {
        "userId": hub.user.id,
        "name": hub.user.name,
        "color": hub.user.color,
        "location": hub.user.location,
        "pitch": hub.user.pitch
      });
    }

    hub.channel('sendText', null, ['others'], function (data) {
      console.log('sendText: ', data)
      var textDiv = document.getElementById('typed-text');
      textDiv.innerHTML = data.text;
    });

    function tapEnd() {
      document.getElementsByClassName("mainDisplay")[0].style.display = 'none';
      document.getElementsByClassName("endDisplay")[0].style.display = 'block';
    }


    function getRandomColor() {
      var letters = '0123456789ABCDEF'.split('');
      var color = '#';
      for (var i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }

    hub.channel('triggerCollide', null, null, function (data) {
      demoSound.playSecondSound();
    });

    hub.channel('triggerPitch');
    hub.channel('triggerFirstSound', null, ['max']);

    var DemoSound = function () {

      this.tone = new Tone();

      this.tremolo = new Tone.Tremolo({
        "frequency": 8,
        "type": "sine",
        "depth": 0.6,
        "spread": 0
        //"wet": 0.8
      }).toMaster().start();

      this.synth = new Tone.Synth({
        "oscillator": {
          "type": "sine"
        },
        "envelope": {
          "attack": 2.0,
          "decay": 0.5,
          "sustain": 0.8,
          "release": 2.0
        }
      }).connect(this.tremolo);

      this.synth.volume.value = -10;

      this.player = [];
      this.player[0] = new Tone.Player("data/mp3s/001-Causeway.mp3").toMaster();
      this.player[1] = new Tone.Player("data/mp3s/Collide.mp3").toMaster();

      Tone.Transport.start();

      this.pitchCollection = [55, 57, 59, 61, 62, 64, 66, 67, 68, 69, 71, 73, 75, 76, 78, 80, 82, 83];

      this.pitch = this.pitchCollection[Math.floor(Math.random() * (this.pitchCollection.length))];
      console.log("Pitch & Length: ", this.pitch, this.pitchCollection.length);

      this.freq = function (midi) {
        var note = Tone.Frequency(midi).midiToFrequency(midi);
        // console.log("Midi: ", midi, note)
        return note;
      };

      // **** Playing Notes **** //
      this.playPitch = function (pitch) {
        if (pitch) {
          this.synth.triggerAttackRelease(this.freq(pitch), 0.5);
        } else {
          this.synth.triggerAttackRelease(this.freq(this.pitch), 5);

        }
      };

      this.playRandomPitch = function () {
        var pitch = this.pitchCollection[Math.floor(Math.random() * (this.pitchCollection.length))];
        this.synth.triggerAttackRelease(this.freq(pitch), 0.5);
      };

      this.triggerPitch = function () {
        this.synth.triggerAttackRelease(this.freq(this.pitch), 5);
        hub.send('triggerPitch', {
          'pitch': this.pitch
        });
      };

      this.playFirstSound = function () {
        this.player[0].start();
      };

      this.triggerFirstSound = function () {
        this.playPitch();
        this.player[0].start();
        // this.seqRandomize();
        hub.send('triggerFirstSound', {
          'pitch': this.pitch
        });

        var elements = document.getElementsByClassName("mainTitle");
        // elements[0].className += " clicked";
        elements[0].style.backgroundColor = hub.user.color;
      };

      // ****  Events ****

      this.playSecondSound = function () {
        this.player[1].start();
        // var pitch = this.pitchCollection[Math.floor(Math.random() * (this.pitchCollection.length))];
        // this.synth.triggerAttackRelease(this.freq(pitch), 5);
        this.playRandomPitch();
      };

    };

    var demoSound = new DemoSound();
    hub.user.pitch = demoSound.pitch;

    var wavesurfer = WaveSurfer.create({
      container: '#waveform',
      waveColor: hub.user.color,
      progressColor: 'purple',
      plugins: [
        WaveSurfer.regions.create({
          // regions: [{
          //         id: 1,
          //         start: 1,
          //         end: 3,
          //         drag: true,
          //         color: 'hsla(400, 100%, 30%, 0.5)'
          //     }]
          // dragSelection: {
          //     slop: 5
          // }
        })
      ]
    });

    // wavesurfer.enableDragSelection({
    //     id: 1,
    //     loop: true
    // });

    wavesurfer.on('ready', function () {
      // wavesurfer.play();
      wavesurfer.addRegion({
        id: 1,
        start: 1,
        end: 3,
        drag: true,
        loop: true,
        color: 'hsla(100, 100%, 30%, 0.5)'
      });
      wavesurfer.regions.list[1].on('update', function () {
        wavesurfer.regions.list[1].play();
        wavesurfer.regions.list[1].un('update');
        wavesurfer.regions.list[1].on('update', function () {
          setLoop();
        });
      });
    });












    // Full Channel Declaration Standard transmit to 'others'
    // expected output: 
    hub.channel('test1', null, null, function (data) {
      console.log('test 1 received: ', data);
    })

    function test1() {
      console.log('test1 activated');
      hub.transmit('test1', null, {
        'test': '1'
      });
    }

    hub.channel('test2', null, ['display'], function (data) {
      console.log('test 2 received: ', data);
    })

    function test2() {
      hub.transmit('test2', null, {
        'test': 2
      });
    }

    // test3 overriding the channel declaration within the transmit function
    hub.channel('test3', null, ['controller'], function (data) {
      console.log('test 3 received: ', data);
    })

    function test3() {
      hub.transmit('test3', ['all'], {
        'test': 3
      });
    }

    // test4 overriding simplified channel declaration within the transmit function
    hub.channel('test4')

    function test4() {
      hub.transmit('test4', ['display'], {
        'test': 4
      });
    }

    // test5 no channel declaration just a transmit function
    function test5() {
      hub.transmit('test5', ['display'], {
        'test': 5
      });
    }

    // Just sending something.
    function test6() {
      hub.send('test6', 6);
    }

  </script>

</body>

</html>